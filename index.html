<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dokumentasi API - MLM Pekerjaan</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF and html2canvas for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Custom styles for better readability and print layout */
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .api-endpoint {
            border-left: 4px solid;
            transition: border-color 0.3s;
        }
        .api-get { border-color: #2563eb; } /* blue-600 */
        .api-post { border-color: #16a34a; } /* green-600 */
        .api-put { border-color: #f97316; } /* orange-500 */
        
        /* Hide button in PDF */
        @media print {
            #download-container {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="doc-container" class="max-w-4xl mx-auto p-4 sm:p-8">
        <!-- Header and Download Button -->
        <header class="flex justify-between items-start mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Dokumentasi API</h1>
                <p class="text-gray-600 mt-1">Sistem Multi-Level Marketing (MLM) Pekerjaan</p>
            </div>
            <div id="download-container">
                <button id="download-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-blue-700 transition duration-300 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Download PDF
                </button>
            </div>
        </header>

        <!-- Main Documentation Content -->
        <main id="doc-content">
            <section class="mb-10">
                <h2 class="text-2xl font-semibold border-b pb-2 mb-4">Pengantar</h2>
                <p>Dokumentasi ini menjelaskan setiap endpoint API yang tersedia untuk aplikasi MLM Pekerjaan. API ini menggunakan autentikasi berbasis <strong class="font-semibold">Bearer Token (JWT)</strong> untuk melindungi endpoint yang membutuhkan hak akses.</p>
                <div class="mt-4 p-4 bg-blue-100 border-l-4 border-blue-500 text-blue-700 rounded-r-lg">
                    <p><strong class="font-semibold">URL Dasar:</strong> Semua endpoint diawali dengan URL dasar aplikasi Anda (misal: `https://your-app.vercel.app`).</p>
                    <p><strong class="font-semibold">Header Autentikasi:</strong> Untuk endpoint yang dilindungi, sertakan header `Authorization: Bearer <TOKEN_JWT>`.</p>
                </div>
            </section>

            <!-- Authentication Endpoints -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold border-b pb-2 mb-6">1. Autentikasi</h2>
                
                <article class="api-endpoint api-post bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-green-600 text-white px-3 py-1 rounded-full">POST</span>
                        <code class="text-lg font-mono ml-3">/api/register</code>
                    </div>
                    <p class="text-gray-600 mb-4">Mendaftarkan pengguna baru. Password akan di-hash secara otomatis.</p>
                    <h4 class="font-semibold mb-2">Request Body:</h4>
                    <pre class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto"><code>{
    "nama": "Budi Santoso",
    "email": "budi.s@example.com",
    "password": "password123",
    "picture": "http://path.to/profile.jpg",
    "kodeReferralUpline": "a1b2c3d4" // Opsional
}</code></pre>
                </article>

                <article class="api-endpoint api-post bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-green-600 text-white px-3 py-1 rounded-full">POST</span>
                        <code class="text-lg font-mono ml-3">/api/login</code>
                    </div>
                    <p class="text-gray-600 mb-4">Login pengguna dan mendapatkan token JWT untuk akses API.</p>
                     <h4 class="font-semibold mb-2">Request Body:</h4>
                    <pre class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto"><code>{
    "email": "budi.s@example.com",
    "password": "password123"
}</code></pre>
                    <h4 class="font-semibold mt-4 mb-2">Success Response (200 OK):</h4>
                    <pre class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto"><code>{
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>
                </article>
            </section>

            <!-- User Endpoints -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold border-b pb-2 mb-6">2. Pengguna (User)</h2>
                <article class="api-endpoint api-get bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-blue-600 text-white px-3 py-1 rounded-full">GET</span>
                        <code class="text-lg font-mono ml-3">/api/me</code>
                        <span class="ml-auto text-xs font-semibold text-red-600">Perlu Autentikasi</span>
                    </div>
                    <p class="text-gray-600">Mendapatkan detail profil pengguna yang sedang login, termasuk daftar downline, upline, dan riwayat transaksi.</p>
                </article>
            </section>

            <!-- Project Endpoints -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold border-b pb-2 mb-6">3. Proyek (Project)</h2>
                <article class="api-endpoint api-get bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-blue-600 text-white px-3 py-1 rounded-full">GET</span>
                        <code class="text-lg font-mono ml-3">/api/projects</code>
                        <span class="ml-auto text-xs font-semibold text-red-600">Perlu Autentikasi</span>
                    </div>
                    <p class="text-gray-600">Mendapatkan semua daftar proyek yang tersedia beserta field dinamis yang harus diisi.</p>
                </article>
                <article class="api-endpoint api-post bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-green-600 text-white px-3 py-1 rounded-full">POST</span>
                        <code class="text-lg font-mono ml-3">/api/projects/:projectId/submit</code>
                        <span class="ml-auto text-xs font-semibold text-red-600">Perlu Autentikasi</span>
                    </div>
                    <p class="text-gray-600 mb-4">Mengirimkan hasil pengerjaan sebuah proyek. Menggunakan `multipart/form-data` karena ada kemungkinan upload file. Setiap `key` dari form-data haruslah `fieldId` dari proyek tersebut.</p>
                    <h4 class="font-semibold mb-2">Contoh Form-Data:</h4>
                    <ul class="list-disc list-inside text-sm bg-gray-100 p-4 rounded-md">
                        <li>Key: `101` (fieldId untuk Nama Lengkap), Value: `Delia Putri`</li>
                        <li>Key: `102` (fieldId untuk Foto KTP), Value: `[File: ktp.jpg]`</li>
                        <li>Key: `103` (fieldId untuk Foto Toko), Value: `[File: toko_depan.png]`</li>
                    </ul>
                </article>
            </section>
            
            <!-- Withdrawal Endpoints -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold border-b pb-2 mb-6">4. Penarikan Dana (Withdrawal)</h2>
                 <article class="api-endpoint api-post bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-green-600 text-white px-3 py-1 rounded-full">POST</span>
                        <code class="text-lg font-mono ml-3">/api/withdrawals</code>
                        <span class="ml-auto text-xs font-semibold text-red-600">Perlu Autentikasi</span>
                    </div>
                    <p class="text-gray-600 mb-4">Mengajukan permintaan penarikan dana dari saldo yang tersedia.</p>
                     <h4 class="font-semibold mb-2">Request Body:</h4>
                    <pre class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto"><code>{
    "totalWithdrawal": 50000
}</code></pre>
                </article>
            </section>

            <!-- Admin Endpoints -->
            <section>
                <h2 class="text-2xl font-semibold border-b pb-2 mb-6">5. Admin</h2>
                <div class="p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-r-lg mb-6">
                    <p><strong class="font-semibold">Perhatian:</strong> Semua endpoint di bawah ini memerlukan hak akses sebagai **ADMIN**.</p>
                </div>
                
                <article class="api-endpoint api-put bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-orange-500 text-white px-3 py-1 rounded-full">PUT</span>
                        <code class="text-lg font-mono ml-3">/api/admin/users/:id/approve</code>
                    </div>
                    <p class="text-gray-600">Menyetujui registrasi pengguna.</p>
                </article>
                
                <article class="api-endpoint api-put bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-orange-500 text-white px-3 py-1 rounded-full">PUT</span>
                        <code class="text-lg font-mono ml-3">/api/admin/submissions/:id/approve</code>
                    </div>
                    <p class="text-gray-600">Menyetujui hasil pengerjaan proyek. Aksi ini akan mentrigger perhitungan dan distribusi komisi secara otomatis ke pengerja dan para upline.</p>
                </article>
                
                <article class="api-endpoint api-put bg-white p-6 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-orange-500 text-white px-3 py-1 rounded-full">PUT</span>
                        <code class="text-lg font-mono ml-3">/api/admin/submissions/:id/reject</code>
                    </div>
                    <p class="text-gray-600 mb-4">Menolak hasil pengerjaan proyek.</p>
                    <h4 class="font-semibold mb-2">Request Body:</h4>
                    <pre class="bg-gray-100 p-4 rounded-md text-sm overflow-x-auto"><code>{
    "noteAdmin": "Foto KTP tidak jelas, harap upload ulang."
}</code></pre>
                </article>

                <article class="api-endpoint api-put bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center mb-2">
                        <span class="text-sm font-bold bg-orange-500 text-white px-3 py-1 rounded-full">PUT</span>
                        <code class="text-lg font-mono ml-3">/api/admin/withdrawals/:id/approve</code>
                    </div>
                    <p class="text-gray-600">Menyetujui permintaan penarikan dana. Saldo pengguna akan otomatis terpotong.</p>
                </article>
            </section>
        </main>
    </div>

    <script>
        // JavaScript for PDF Download Functionality
        document.getElementById('download-btn').addEventListener('click', () => {
            const downloadButton = document.getElementById('download-container');
            const docContent = document.getElementById('doc-content');
            const docContainer = document.getElementById('doc-container');

            // Temporarily hide the button
            downloadButton.style.display = 'none';

            // Use html2canvas to capture the content
            html2canvas(docContainer, {
                scale: 2, // Increase scale for better resolution
                useCORS: true,
                logging: true,
                width: docContainer.scrollWidth,
                height: docContainer.scrollHeight,
                windowWidth: docContainer.scrollWidth,
                windowHeight: docContainer.scrollHeight
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                
                // Initialize jsPDF
                // Use jspdf.jsPDF because we are using the UMD module
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                
                const ratio = canvasWidth / canvasHeight;
                const imgWidth = pdfWidth;
                const imgHeight = imgWidth / ratio;
                
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pdfHeight;

                // Handle content that spans multiple pages
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }

                // Save the PDF
                pdf.save('api-documentation-mlm.pdf');

                // Show the button again
                downloadButton.style.display = 'block';
            }).catch(err => {
                console.error("Error generating PDF:", err);
                // Ensure button is shown again even if there's an error
                downloadButton.style.display = 'block';
            });
        });
    </script>

</body>
</html>
